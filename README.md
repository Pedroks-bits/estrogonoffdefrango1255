javascript:(async()=>{if(window.location.hostname!=='www.keplaca.com'){window.location.href='https://www.keplaca.com/';return}if(document.getElementById('ed-hub'))return;const API_ENDPOINT='https://andromedaxyz.created.app/api/';const loadPuter=()=>{return new Promise((resolve,reject)=>{if(window.puter&&window.puter.ai){resolve();return}const existing=document.querySelector('script[src="https://js.puter.com/v2/"]');if(existing){if(window.puter&&window.puter.ai)resolve();else existing.addEventListener('load',()=>resolve(),{once:true});return}const script=document.createElement('script');script.src='https://js.puter.com/v2/';script.async=true;script.defer=true;script.onload=()=>{const check=()=>{if(window.puter&&typeof window.puter.ai?.chat==='function'){resolve()}else{setTimeout(check,100)}};check();};script.onerror=reject;document.head.appendChild(script);});};const createSound=(freq=400,dur=0.1)=>{try{const ctx=new(window.AudioContext||window.webkitAudioContext);const osc=ctx.createOscillator();const gain=ctx.createGain();osc.type='sine';osc.frequency.value=freq;gain.gain.setValueAtTime(0.2,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+dur);osc.connect(gain);gain.connect(ctx.destination);osc.start();osc.stop(ctx.currentTime+dur);}catch(e){}};const parseCSV=(text)=>{const lines=text.split('\n').filter(l=>l.trim());const products=[];for(let i=1;i<lines.length;i++){const cols=lines[i].split('","');if(cols.length<10)continue;const title=cols[0].replace(/^"/,'');const priceStr=cols[15]||cols[14]||'0';const price=parseFloat(priceStr.replace(/,/g,'.'))||0;const img=cols[26]||cols[17]||'';if(title&&img&&price>0){products.push({title,img,price});}}return products;};const saveProducts=(products)=>{try{localStorage.setItem('ed-products',JSON.stringify(products));}catch(e){}};const loadProducts=()=>{try{const data=localStorage.getItem('ed-products');return data?JSON.parse(data):null;}catch(e){return null}};const s=document.createElement('style');s.textContent=`*{cursor:url("image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' fill='none' stroke='%23ff3333' stroke-width='2'/%3E%3Cpath d='M12 8v8M8 12h8' stroke='%23ff3333' stroke-width='2'/%3E%3C/svg%3E"), pointer !important}#ed-hub{position:fixed;top:0;left:0;width:100%;height:100%;z-index:2147483647;background:#000;display:flex;justify-content:center;align-items:center;padding:16px;overflow:hidden}#ed-panel{width:100%;max-width:800px;background:#120c12;border-radius:24px;padding:34px;color:#f8f8f8;font-family:'Inter',sans-serif;position:relative;max-height:94vh;overflow-y:auto;box-shadow:0 14px 45px rgba(0,0,0,0.8);border:1px solid rgba(255,60,60,0.3);z-index:1;opacity:0;animation:edPopIn 0.7s cubic-bezier(0.16,0.88,0.32,1.27) forwards}@keyframes edPopIn{0%{opacity:0;transform:scale(0.88) rotate(-1deg)}100%{opacity:1;transform:scale(1) rotate(0)}}#ed-panel::-webkit-scrollbar{width:8px}#ed-panel::-webkit-scrollbar-track{background:transparent}#ed-panel::-webkit-scrollbar-thumb{background:linear-gradient(to bottom,#ff5555,#cc0000);border-radius:4px}#ed-panel::-webkit-scrollbar-thumb:hover{background:linear-gradient(to bottom,#ff7777,#ff3333)}#ed-title{font-family:'Montserrat',sans-serif;font-size:2.5rem;font-weight:800;text-align:center;margin:0 0 20px;background:linear-gradient(135deg,#ff7a7a,#ff4545,#cc0000);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 0 12px rgba(255,70,70,0.5)}#ed-btns{display:flex;gap:10px;margin:16px 0;flex-wrap:wrap}#ed-btns button{flex:1;min-width:120px;background:linear-gradient(135deg,#ff3333,#cc0000);color:white;border:none;padding:12px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 4px 14px rgba(255,50,50,0.4)}#ed-btns button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(255,50,50,0.6)}#ed-placa{width:100%;padding:16px;margin:12px 0;border:2px solid #555;background:#1a1010;color:#ffe0e0;border-radius:16px;text-align:center;font-size:20px;letter-spacing:3px;text-transform:uppercase;outline:none}#ed-placa:focus{border-color:#ff3333;box-shadow:0 0 0 4px rgba(255,50,50,0.25)}.ed-glow-hover{cursor:pointer;transition:all 0.25s;font-weight:600}.ed-glow-hover:hover{font-weight:700;color:#ff6666}#ed-cat{display:none;grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:14px;margin:24px 0}#ed-cat img{width:44px;height:44px;object-fit:contain}#ed-ia{margin-top:28px;background:rgba(25,15,15,0.9);border-radius:16px;padding:22px;position:relative;display:none;border:1px solid #502020}#ed-mode-btn{position:absolute;top:12px;right:12px;background:linear-gradient(135deg,#ff5555,#ff2222);color:white;border:none;border-radius:10px;padding:8px 14px;font-weight:700;font-size:13px;cursor:pointer;box-shadow:0 4px 12px rgba(255,0,0,0.4)}#ed-mode-btn:hover{transform:scale(1.05);box-shadow:0 6px 16px rgba(255,0,0,0.55)}#ed-ia pre{color:#ffe0e0;white-space:pre-wrap;line-height:1.6;font-size:14px;max-height:280px;overflow:auto;font-family:'Inter',monospace}#ed-products{margin-top:24px}#ed-products h3{color:#ff7777;margin:16px 0 10px;font-size:16px}#ed-prod-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:12px}#ed-prod-grid img{width:100%;border-radius:6px;border:1px solid #444;cursor:pointer}#ed-loading{color:#ff9999;text-align:center;margin:20px 0;display:flex;align-items:center;justify-content:center;gap:12px;font-size:18px;animation:edBounce 1.2s infinite}@keyframes edBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}#ed-error{color:#ff6666;text-align:center;font-weight:600;margin:20px 0}.ed-hidden{display:none}#ed-credit{font-size:11px;color:#777;margin-top:20px;text-align:center}`;document.head.appendChild(s);const root=document.createElement('div');root.id='ed-hub';root.innerHTML=`<div id="ed-panel"><h1 id="ed-title">Eduardo-Diesel HUB</h1><input id="ed-placa" placeholder="Ex: ABC1D23" maxlength="7" autocomplete="off"/><div id="ed-btns"><button onclick="edSearch()"><i class="fas fa-search"></i> Consultar Placa</button><button onclick="edImportCSV()"><i class="fas fa-file-csv"></i> Importar Produtos</button></div><div id="ed-vehicle"></div><div id="ed-cat"><button onclick="edAsk('motor')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44"><path fill="#ff4444" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/></svg><div>Motor</div></button><button onclick="edAsk('cambio')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44"><path fill="#ff4444" d="M4,6H20V18H4V6M6,8V16H8V8H6M10,8V16H12V8H10M14,8V16H16V8H14M18,8V16H20V8H18Z"/></svg><div>C√¢mbio</div></button><button onclick="edAsk('diferencial')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44"><path fill="#ff4444" d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M9,6H15V10H9V6M9,14H15V18H9V14Z"/></svg><div>Dif.</div></button><button onclick="edAsk('oleo')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44"><path fill="#ff4444" d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2M12,4L9.38,9.25L8,9.07L7.38,12.5L12,15L16.62,12.5L16,9.07L14.62,9.25L12,4Z"/></svg><div>F. √ìleo</div></button><button onclick="edAsk('combustivel')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44"><path fill="#ff4444" d="M12,3L6,7V12C6,15 8,18 12,21C16,18 18,15 18,12V7L12,3M12,5L15,7V12C15,13.5 14,15 12,16C10,15 9,13.5 9,12V7L12,5Z"/></svg><div>F. Comb.</div></button><button onclick="edAsk('ar')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44"><path fill="#ff4444" d="M16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8A4,4 0 0,1 16,12M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M20,14C17.5,17.5 14,20 12,20C10,20 6.5,17.5 4,14V12C6.5,15.5 10,18 12,18C14,18 17.5,15.5 20,12V14Z"/></svg><div>F. Ar</div></button></div><div id="ed-ia"><button id="ed-mode-btn" onclick="edToggleMode()"><i class="fas fa-sync-alt"></i> <span id="ed-mode-text">Explicativo</span></button><pre id="ed-ia-text"></pre><div id="ed-followup" style="display:none;margin-top:12px"><input type="text" id="ed-followup-input" placeholder="Digite sua d√∫vida..."/><button onclick="edFollowUp()" style="width:100%;margin-top:6px;background:#ff5555">üí¨ Continuar com a IA</button></div><div id="ed-products" style="display:none"><h3>Produtos Sugeridos</h3><div id="ed-prod-grid"></div></div></div><div id="ed-credit">Desenvolvido por Pedro Henrique Hip√≥lito Maciel</div><input type="file" id="ed-csv-input" accept=".csv" style="display:none" onchange="edHandleCSV(this.files[0])"/></div>`;document.body.appendChild(root);let edVehicle=null,edMode='explicativo';window.edToggleMode=()=>{edMode=edMode==='explicativo'?'direto':'explicativo';document.getElementById('ed-mode-text').textContent=edMode==='explicativo'?'Explicativo':'Direto';createSound(500,0.15)};window.edImportCSV=()=>{document.getElementById('ed-csv-input').click()};window.edHandleCSV=(file)=>{if(!file)return;const reader=new FileReader();reader.onload=(e)=>{try{const products=parseCSV(e.target.result);saveProducts(products);alert(`‚úÖ ${products.length} produtos importados!`);createSound(600,0.2);}catch(err){alert('‚ùå Erro ao processar CSV.');createSound(200,0.2);}};reader.readAsText(file);};window.edSearch=async()=>{createSound(300,0.1);const inp=document.getElementById('ed-placa'),placa=inp.value.trim().toUpperCase().replace(/[^A-Z0-9]/g,''),res=document.getElementById('ed-vehicle'),cat=document.getElementById('ed-cat'),prodBox=document.getElementById('ed-products');res.innerHTML='';cat.style.display='none';prodBox.style.display='none';document.getElementById('ed-prod-grid').innerHTML='';if(!placa||!(/^[A-Z]{3}[0-9]{4}$/.test(placa)||/^[A-Z]{3}[0-9][A-Z][0-9]{2}$/.test(placa))){res.innerHTML='<div class="ed-error">‚ö†Ô∏è Formato inv√°lido. Use ABC1234 ou ABC1D23.</div>';createSound(200,0.2);return}res.innerHTML='<div class="ed-loading"><i class="fas fa-search"></i> Consultando KePlaca...</div>';try{const url=`https://www.keplaca.com/placa?placa-fipe=${placa}`;const response=await fetch(url);if(!response.ok)throw new Error('Falha na rede');const html=await response.text();if(html.includes('formato inv√°lido')||html.includes('n√£o foi encontrada')){res.innerHTML='<div class="ed-error">‚ùå Placa inv√°lida.</div>';createSound(220,0.25);return}const temp=document.createElement('div');temp.innerHTML=html;const table=temp.querySelector('.fipeTablePriceDetail');if(!table){res.innerHTML='<div class="ed-error">‚ö†Ô∏è Dados n√£o carregados.</div>';createSound(240,0.2);return}const data={};table.querySelectorAll('tr').forEach(row=>{const tds=row.querySelectorAll('td');if(tds[0]&&tds[1]){let k=tds[0].innerText.replace(':','').trim();let v=tds[1].innerText.trim();data[k]=v;}});res.innerHTML=Object.entries(data).map(([k,v])=>`<div class="lbl ed-glow-hover">${k}:</div><div class="ed-value ed-glow-hover">${v}</div>`).join('');edVehicle=data;cat.style.display='grid';createSound(600,0.15);}catch(e){res.innerHTML='<div class="ed-error">üö® Erro na consulta.</div>';createSound(180,0.3);}};window.edAsk=async(cat)=>{createSound(350,0.12);if(!edVehicle){alert('‚ö†Ô∏è Consulte uma placa primeiro.');createSound(200,0.2);return}await loadPuter();const tipoMap={motor:'√≥leo de motor',cambio:'√≥leo de c√¢mbio',diferencial:'√≥leo de diferencial',oleo:'filtro de √≥leo',combustivel:'filtro de combust√≠vel',ar:'filtro de ar'};const itemName=tipoMap[cat]||'item';const prompt=`Voc√™ √© especialista em ve√≠culos comerciais. Ve√≠culo: ${edVehicle['Marca']} ${edVehicle['Modelo']}, Ano ${edVehicle['Ano']}, Combust√≠vel ${edVehicle['Combust√≠vel']}, Segmento ${edVehicle['Segmento']}. Liste marcas e modelos reais de ${itemName} recomendados. Formato: Comum: - [Marca Produto] Adapt√°veis: - [Marca Produto]`;const txt=document.getElementById('ed-ia-text');const followupDiv=document.getElementById('ed-followup');const prodBox=document.getElementById('ed-products');document.getElementById('ed-ia').style.display='block';followupDiv.style.display='none';prodBox.style.display='none';document.getElementById('ed-prod-grid').innerHTML='';txt.textContent='üß† Consultando IA Puter...';try{const response=await puter.ai.chat(prompt,{model:'perplexity/sonar'});txt.textContent=response;followupDiv.style.display='block';setTimeout(()=>edMatchProducts(response),500);}catch(e){txt.textContent='‚ùå Erro na IA Puter: '+e.message;createSound(190,0.25);}};window.edFollowUp=async()=>{const input=document.getElementById('ed-followup-input');const question=input.value.trim();if(!question){alert('Digite sua d√∫vida.');return}await loadPuter();const fullPrompt=`Contexto anterior + nova pergunta: ${question}`;const txt=document.getElementById('ed-ia-text');const prodBox=document.getElementById('ed-products');prodBox.style.display='none';document.getElementById('ed-prod-grid').innerHTML='';txt.textContent='üß† Processando...';try{const response=await puter.ai.chat(fullPrompt,{model:'perplexity/sonar'});txt.textContent=response;input.value='';createSound(500,0.1);setTimeout(()=>edMatchProducts(response),300);}catch(e){txt.textContent='‚ùå Erro na IA.';createSound(200,0.2);}};window.edMatchProducts=(text)=>{const products=loadProducts()||[];const lines=text.split('\n');let comum=[],adapt=[],inComum=false,inAdapt=false;for(const line of lines){const clean=line.trim();if(clean==='Comum:'){inComum=true;inAdapt=false;continue;}if(clean.includes('Adapt')){inComum=false;inAdapt=true;continue;}if(clean.startsWith('- ')){const item=clean.substring(2).trim();for(const p of products){if(item.toLowerCase().includes(p.title.toLowerCase())){if(inComum&&!comum.find(x=>x.title===p.title))comum.push(p);if(inAdapt&&!adapt.find(x=>x.title===p.title))adapt.push(p);}}}}const allProds=[...comum,...adapt];if(allProds.length>0){const names=allProds.map(p=>p.title).join(', ');const payload=`{${names}}`;fetch(API_ENDPOINT+encodeURIComponent(payload)).catch(()=>{});const grid=document.getElementById('ed-prod-grid');grid.innerHTML='';if(comum.length>0){grid.innerHTML+='<div style="grid-column:1/-1;font-weight:bold;color:#ff7777;margin-top:12px">Comum</div>';comum.forEach(p=>{const img=document.createElement('img');img.src=p.img;img.title=`${p.title} - R$${p.price}`;grid.appendChild(img);});}if(adapt.length>0){grid.innerHTML+='<div style="grid-column:1/-1;font-weight:bold;color:#ff9999;margin-top:12px">Adapt√°veis</div>';adapt.forEach(p=>{const img=document.createElement('img');img.src=p.img;img.title=`${p.title} - R$${p.price}`;grid.appendChild(img);});}document.getElementById('ed-products').style.display='block';}}})();
